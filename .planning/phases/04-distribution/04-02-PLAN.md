---
phase: 04-distribution
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified: []
autonomous: false
user_setup:
  - service: inno-setup
    why: "Windows installer compilation requires Inno Setup installed on Windows"
    dashboard_config:
      - task: "Download and install Inno Setup 6.x"
        location: "https://jrsoftware.org/isdl.php"

must_haves:
  truths:
    - "Application bundles successfully with PyInstaller on Windows"
    - "Installer compiles successfully with Inno Setup on Windows"
    - "Application launches from installed location without Python"
    - "Start Menu shortcut works correctly"
    - "All ifcopenshell native dependencies are bundled (no DLL errors)"
  artifacts:
    - path: "dist/IFC Translate Tool/IFC Translate Tool.exe"
      provides: "Bundled executable"
    - path: "installer/Output/IFC_Translate_Tool_Setup.exe"
      provides: "Windows installer (created by user)"
  key_links:
    - from: "IFC Translate Tool.exe"
      to: "ifcopenshell native wrapper"
      via: "bundled DLLs"
      pattern: "_ifcopenshell_wrapper"
---

<objective>
Build and test Windows executable and installer on Windows machine.

Purpose: Verify that the PyInstaller and Inno Setup configurations work correctly and produce a functioning Windows application that runs without Python installed.

Output:
- Verified working Windows executable
- Verified working Windows installer
- Confirmation of DIST-01 requirement completion
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-distribution/04-RESEARCH.md
@.planning/phases/04-distribution/04-01-SUMMARY.md

@ifc_translate.spec
@installer/setup.iss
@requirements-dev.txt
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <action>Build executable and installer on Windows</action>
  <instructions>
This task requires a Windows machine. The configuration files were created in Plan 04-01.

**Step 1: Set up Windows build environment**
1. Copy project to Windows machine (or use existing Windows dev environment)
2. Install Python 3.11 (if not already installed)
3. Create virtual environment: `python -m venv .venv`
4. Activate: `.venv\Scripts\activate`
5. Install dev dependencies: `pip install -r requirements-dev.txt`

**Step 2: Build with PyInstaller**
```cmd
pyinstaller ifc_translate.spec
```
This creates: `dist\IFC Translate Tool\IFC Translate Tool.exe`

**Step 3: Test the built executable**
1. Navigate to `dist\IFC Translate Tool\`
2. Run `IFC Translate Tool.exe`
3. Verify:
   - Application launches without errors
   - No console window appears
   - UI displays correctly
   - Try a transformation on a test IFC file
   - Verify preset save/load works
   - Verify batch mode works

**Step 4: Build installer with Inno Setup**
1. Install Inno Setup 6.x from https://jrsoftware.org/isdl.php (if not installed)
2. Open `installer\setup.iss` in Inno Setup
3. Compile (Ctrl+F9 or Build > Compile)
4. Output: `installer\Output\IFC_Translate_Tool_Setup.exe`

**Step 5: Test installer on clean machine (ideal) or same machine**
1. Run `IFC_Translate_Tool_Setup.exe`
2. Follow installation wizard
3. Verify:
   - Application installs to Program Files
   - Start Menu shortcut appears
   - Desktop shortcut appears (if selected)
   - Launch from Start Menu works
   - Application functions correctly

**If issues occur:**
- DLL errors: Check PyInstaller output for missing binaries, may need to add explicit hiddenimports
- Recipe not found: Check that ifcpatch recipes directory is in dist folder
- Console window appears: Verify console=False in spec file
- Permission errors on install: Run installer as administrator

Report results including any errors encountered.
  </instructions>
  <resume-signal>
Report build results:
- PyInstaller build: SUCCESS / FAILED (with error)
- Executable test: SUCCESS / FAILED (with error)
- Inno Setup compile: SUCCESS / FAILED (with error)
- Installer test: SUCCESS / FAILED (with error)
- Any issues or modifications needed
  </resume-signal>
</task>

<task type="auto">
  <name>Task 2: Document build results and update roadmap</name>
  <files>.planning/ROADMAP.md, .planning/STATE.md</files>
  <action>
Based on checkpoint results:

If SUCCESS:
- Update ROADMAP.md Phase 4 to Complete status
- Update STATE.md to reflect project completion
- Mark DIST-01 requirement as complete in requirements traceability

If FAILED:
- Document the failure in summary
- Identify what configuration changes are needed
- Note whether additional plans are needed to address issues
  </action>
  <verify>
- If success: `grep "Complete" .planning/ROADMAP.md` shows Phase 4 complete
- STATE.md reflects final status
  </verify>
  <done>
- Project documentation updated to reflect distribution phase outcome
- DIST-01 requirement status documented
  </done>
</task>

</tasks>

<verification>
Phase 4 Distribution verification:
- [ ] PyInstaller produces executable without errors
- [ ] Executable runs without Python installed
- [ ] No DLL load errors (ifcopenshell native wrapper loads)
- [ ] Transformation works in bundled app
- [ ] Inno Setup produces installer
- [ ] Installer creates working shortcuts
- [ ] Application launches from Start Menu
</verification>

<success_criteria>
1. dist/IFC Translate Tool/IFC Translate Tool.exe exists and runs
2. Application transforms IFC files correctly when bundled
3. installer/Output/IFC_Translate_Tool_Setup.exe installs successfully
4. Start Menu shortcut launches application
5. No Python installation required on target machine
</success_criteria>

<output>
After completion, create `.planning/phases/04-distribution/04-02-SUMMARY.md`
</output>
