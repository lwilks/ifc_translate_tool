---
phase: 01-core-transformation-basic-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main.py
  - src/model.py
  - requirements.txt
autonomous: true

must_haves:
  truths:
    - "Project structure exists with src/ directory"
    - "IfcPatch can be imported without errors"
    - "Model can transform IFC files with offset and rotation parameters"
  artifacts:
    - path: "requirements.txt"
      provides: "Python dependencies"
      contains: "ifcopenshell"
    - path: "src/model.py"
      provides: "IFC transformation logic"
      exports: ["IFCTransformModel"]
    - path: "src/main.py"
      provides: "Application entry point"
      min_lines: 5
  key_links:
    - from: "src/model.py"
      to: "ifcpatch"
      via: "import and execute"
      pattern: "ifcpatch\\.execute"
---

<objective>
Create the project foundation and core transformation model layer.

Purpose: Establish the project structure and implement the core IFC transformation logic that all UI will rely on. This is the technical foundation that proves IfcPatch integration works.

Output: Working project skeleton with model layer that can transform IFC files via IfcPatch.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-core-transformation-basic-ui/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create project structure and dependencies</name>
  <files>
    requirements.txt
    src/__init__.py
    src/main.py
  </files>
  <action>
    Create the project foundation:

    1. Create `requirements.txt` with:
       - ifcopenshell (0.8.4+ will be installed, includes ifcpatch)

    2. Create `src/` directory with `__init__.py` (empty file)

    3. Create `src/main.py` as placeholder entry point:
       - Import statement for future model, view, controller
       - if __name__ == "__main__" block that prints "IFC Translate Tool starting..." for now
       - Will be expanded in Plan 03

    4. Create virtual environment and install dependencies:
       - python3 -m venv .venv
       - .venv/bin/pip install -r requirements.txt

    IMPORTANT: Use ifcopenshell (not ifcpatch separately) - ifcpatch is bundled with ifcopenshell 0.8.0+
  </action>
  <verify>
    Run: source .venv/bin/activate && python -c "import ifcopenshell; import ifcpatch; print('OK')"
    Should print "OK" without errors.
  </verify>
  <done>
    - requirements.txt exists with ifcopenshell
    - src/ directory exists with __init__.py
    - src/main.py exists and is runnable
    - Virtual environment created and dependencies installed
    - ifcopenshell and ifcpatch can be imported
  </done>
</task>

<task type="auto">
  <name>Task 2: Create IFCTransformModel with IfcPatch integration</name>
  <files>
    src/model.py
  </files>
  <action>
    Create the model layer that wraps IfcPatch's OffsetObjectPlacements recipe:

    1. Create `src/model.py` with class `IFCTransformModel`:

    2. Implement `transform_file()` method with signature:
       ```python
       def transform_file(
           self,
           input_path: str,
           output_path: str,
           x: float,
           y: float,
           z: float,
           should_rotate_first: bool,
           rotation_z: float | None = None
       ) -> bool:
       ```

    3. Implementation details (from RESEARCH.md):
       - Open IFC file: `ifc_file = ifcopenshell.open(input_path)`
       - Build arguments list: `[x, y, z, should_rotate_first]`
       - If rotation_z is not None, append it to arguments
       - Execute: `ifcpatch.execute({"input": str(input_path), "file": ifc_file, "recipe": "OffsetObjectPlacements", "arguments": arguments})`
       - Write output: `ifcpatch.write(output, str(output_path))`
       - Return True on success

    4. Error handling:
       - Catch RuntimeError from ifcopenshell.open() - raise ValueError with user-friendly message "Invalid IFC file: {original error}"
       - Catch other exceptions - raise Exception with "Transformation failed: {error}"
       - Use logging module for debug output (import logging at top)

    5. Add docstring explaining:
       - What the method does
       - That rotation is around Z axis (2D rotation)
       - That should_rotate_first=True means rotate then translate
  </action>
  <verify>
    Create a simple test (can be inline in a test file or via python -c):
    ```bash
    cd /Users/liamwilks/code/ifc_translate_tool && source .venv/bin/activate && python -c "
    from src.model import IFCTransformModel
    model = IFCTransformModel()
    print('Model instantiated OK')
    # Verify method exists with correct signature
    import inspect
    sig = inspect.signature(model.transform_file)
    params = list(sig.parameters.keys())
    expected = ['input_path', 'output_path', 'x', 'y', 'z', 'should_rotate_first', 'rotation_z']
    assert params == expected, f'Expected {expected}, got {params}'
    print('Method signature correct')
    "
    ```
  </verify>
  <done>
    - src/model.py exists with IFCTransformModel class
    - transform_file() method has correct signature
    - Method uses ifcpatch.execute with OffsetObjectPlacements recipe
    - Error handling converts RuntimeError to user-friendly ValueError
    - Logging configured for debug output
  </done>
</task>

</tasks>

<verification>
Run all verification commands:
1. `source .venv/bin/activate && python -c "import ifcopenshell; import ifcpatch; print('Imports OK')"`
2. `python -c "from src.model import IFCTransformModel; print('Model import OK')"`
3. `python src/main.py` - should print startup message

All should pass without errors.
</verification>

<success_criteria>
- Project structure created (src/, requirements.txt, .venv/)
- IfcOpenShell 0.8.4+ installed with ifcpatch bundled
- IFCTransformModel class exists with transform_file() method
- Method signature matches expected parameters
- Error handling implemented for invalid IFC files
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-transformation-basic-ui/01-01-SUMMARY.md`
</output>
