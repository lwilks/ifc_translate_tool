---
phase: 01-core-transformation-basic-ui
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/utils/__init__.py
  - src/utils/validation.py
  - src/view.py
autonomous: true

must_haves:
  truths:
    - "Input file validation rejects non-existent and non-IFC files"
    - "Output directory validation rejects non-writable paths"
    - "Tkinter window displays with all form fields"
    - "Float input validation prevents non-numeric entry"
  artifacts:
    - path: "src/utils/validation.py"
      provides: "Path validation functions"
      exports: ["validate_input_file", "validate_output_directory", "build_output_path"]
    - path: "src/view.py"
      provides: "Tkinter UI components"
      exports: ["TransformView"]
  key_links:
    - from: "src/view.py"
      to: "tkinter"
      via: "import and widget creation"
      pattern: "tkinter|filedialog|messagebox"
    - from: "src/utils/validation.py"
      to: "pathlib"
      via: "Path operations"
      pattern: "from pathlib import Path"
---

<objective>
Create the validation utilities and Tkinter view layer.

Purpose: Build the input validation logic and the complete UI that users will interact with. This plan delivers the visual interface and input guards that ensure data quality before transformation.

Output: Working validation module and Tkinter view with all form fields (file selection, offset inputs, rotation, checkbox, buttons).
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-core-transformation-basic-ui/01-RESEARCH.md
@.planning/phases/01-core-transformation-basic-ui/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create validation utilities</name>
  <files>
    src/utils/__init__.py
    src/utils/validation.py
  </files>
  <action>
    Create the validation module for file path handling:

    1. Create `src/utils/` directory with empty `__init__.py`

    2. Create `src/utils/validation.py` with three functions:

    **validate_input_file(file_path: str) -> Path:**
    - Return early with ValueError if file_path is empty: "No file selected"
    - Convert to Path object
    - Check path.exists(): raise ValueError if not "File does not exist: {path}"
    - Check path.is_file(): raise ValueError if not "Path is not a file: {path}"
    - Check path.suffix.lower() == '.ifc': raise ValueError if not "File must be .ifc format, got: {suffix}"
    - Check os.access(path, os.R_OK): raise ValueError if not "No read permission for file: {path}"
    - Return the Path object on success

    **validate_output_directory(dir_path: str) -> Path:**
    - Return early with ValueError if dir_path is empty: "No output directory selected"
    - Convert to Path object
    - Check path.exists(): raise ValueError if not "Directory does not exist: {path}"
    - Check path.is_dir(): raise ValueError if not "Path is not a directory: {path}"
    - Check os.access(path, os.W_OK): raise ValueError if not "No write permission for directory: {path}"
    - Return the Path object on success

    **build_output_path(input_path: str | Path, output_dir: str | Path) -> Path:**
    - Convert both to Path objects
    - Return output_dir / input_path.name (preserves original filename per FILE-04)

    3. Import statements at top:
       - from pathlib import Path
       - import os
  </action>
  <verify>
    ```bash
    cd /Users/liamwilks/code/ifc_translate_tool && source .venv/bin/activate && python -c "
    from src.utils.validation import validate_input_file, validate_output_directory, build_output_path
    from pathlib import Path
    import tempfile
    import os

    # Test validate_input_file rejects empty
    try:
        validate_input_file('')
        assert False, 'Should have raised'
    except ValueError as e:
        assert 'No file selected' in str(e)
        print('Empty file rejection: OK')

    # Test validate_output_directory rejects empty
    try:
        validate_output_directory('')
        assert False, 'Should have raised'
    except ValueError as e:
        assert 'No output directory' in str(e)
        print('Empty dir rejection: OK')

    # Test build_output_path preserves filename
    result = build_output_path('/input/test.ifc', '/output')
    assert result == Path('/output/test.ifc'), f'Expected /output/test.ifc, got {result}'
    print('Filename preservation: OK')

    # Test validate_output_directory accepts valid dir
    with tempfile.TemporaryDirectory() as tmpdir:
        result = validate_output_directory(tmpdir)
        assert result == Path(tmpdir)
        print('Valid dir acceptance: OK')

    print('All validation tests passed')
    "
    ```
  </verify>
  <done>
    - src/utils/validation.py exists with three functions
    - validate_input_file raises ValueError for invalid paths
    - validate_output_directory raises ValueError for invalid directories
    - build_output_path correctly preserves original filename
    - All validation tests pass
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Tkinter view with all form fields</name>
  <files>
    src/view.py
  </files>
  <action>
    Create the Tkinter view layer with all UI components:

    1. Create `src/view.py` with class `TransformView`:

    2. **__init__(self, root: tk.Tk):**
       - Store root reference
       - Initialize controller as None (set later via set_controller)
       - Set window title: "IFC Translate Tool"
       - Set reasonable geometry: "550x400"
       - Create all widgets (see below)
       - Layout using pack() or grid()

    3. **Widgets to create:**

       **File Selection Frame:**
       - Label: "Input IFC File:"
       - Entry field bound to StringVar (self.input_file_var)
       - "Browse..." Button that calls _select_input_file()

       **Output Directory Frame:**
       - Label: "Output Directory:"
       - Entry field bound to StringVar (self.output_dir_var)
       - "Browse..." Button that calls _select_output_dir()

       **Offset Fields Frame:**
       - Label: "X Offset:"
       - Entry with validatecommand for float (self.x_var, default "0")
       - Label: "Y Offset:"
       - Entry with validatecommand for float (self.y_var, default "0")
       - Label: "Z Offset:"
       - Entry with validatecommand for float (self.z_var, default "0")

       **Rotation Field Frame:**
       - Label: "Rotation (degrees):"
       - Entry with validatecommand for float (self.rotation_var, default "0")

       **Checkbox:**
       - Checkbutton: "Rotate First (apply rotation before translation)"
       - Bound to BooleanVar (self.rotate_first_var, default True)

       **Action Button:**
       - Button: "Process" that calls _on_process_clicked()

       **Status Display:**
       - Label for status messages (self.status_var, default "Ready")

    4. **Methods:**

       **_validate_float(self, value_if_allowed: str) -> bool:**
       - Return True if empty string or "-" (user typing)
       - Return False if more than one decimal point
       - Try float(value_if_allowed), return True if succeeds, False if ValueError
       - Register this with root.register() for validatecommand

       **_select_input_file(self):**
       - Use filedialog.askopenfilename with title="Select IFC File"
       - filetypes=[("IFC files", "*.ifc"), ("All files", "*.*")]
       - If filename selected, set self.input_file_var

       **_select_output_dir(self):**
       - Use filedialog.askdirectory with title="Select Output Directory"
       - If directory selected, set self.output_dir_var

       **_on_process_clicked(self):**
       - If self.controller is not None, call self.controller.on_process_clicked()

       **set_controller(self, controller):**
       - Store controller reference

       **get_values(self) -> dict:**
       - Return dict with all form values:
         - input_file: self.input_file_var.get()
         - output_dir: self.output_dir_var.get()
         - x: float(self.x_var.get() or "0")
         - y: float(self.y_var.get() or "0")
         - z: float(self.z_var.get() or "0")
         - rotation: float(self.rotation_var.get() or "0")
         - rotate_first: self.rotate_first_var.get()

       **show_status(self, message: str):**
       - Set self.status_var to message

       **show_error(self, message: str):**
       - Use messagebox.showerror("Error", message)

       **show_success(self, message: str):**
       - Use messagebox.showinfo("Success", message)

       **set_processing(self, is_processing: bool):**
       - If processing: disable process button, show "Processing..."
       - If not processing: enable process button, show "Ready"

    5. **Imports:**
       - import tkinter as tk
       - from tkinter import filedialog, messagebox
  </action>
  <verify>
    ```bash
    cd /Users/liamwilks/code/ifc_translate_tool && source .venv/bin/activate && python -c "
    import tkinter as tk
    from src.view import TransformView

    # Create root but don't show (withdraw)
    root = tk.Tk()
    root.withdraw()

    # Instantiate view
    view = TransformView(root)
    print('View instantiated: OK')

    # Check all StringVars exist
    assert hasattr(view, 'input_file_var'), 'Missing input_file_var'
    assert hasattr(view, 'output_dir_var'), 'Missing output_dir_var'
    assert hasattr(view, 'x_var'), 'Missing x_var'
    assert hasattr(view, 'y_var'), 'Missing y_var'
    assert hasattr(view, 'z_var'), 'Missing z_var'
    assert hasattr(view, 'rotation_var'), 'Missing rotation_var'
    assert hasattr(view, 'rotate_first_var'), 'Missing rotate_first_var'
    print('All StringVars present: OK')

    # Check get_values returns dict with expected keys
    values = view.get_values()
    expected_keys = ['input_file', 'output_dir', 'x', 'y', 'z', 'rotation', 'rotate_first']
    for key in expected_keys:
        assert key in values, f'Missing key: {key}'
    print('get_values() returns correct keys: OK')

    # Check defaults
    assert values['x'] == 0.0
    assert values['y'] == 0.0
    assert values['z'] == 0.0
    assert values['rotation'] == 0.0
    assert values['rotate_first'] == True
    print('Default values correct: OK')

    root.destroy()
    print('All view tests passed')
    "
    ```
  </verify>
  <done>
    - src/view.py exists with TransformView class
    - All form fields present (file input, output dir, X/Y/Z offset, rotation, rotate first checkbox)
    - File dialogs working for file and directory selection
    - Float validation on numeric entry fields
    - get_values() returns all form data as dict
    - Status display methods implemented
    - All view tests pass
  </done>
</task>

</tasks>

<verification>
Run all verification commands:
1. `source .venv/bin/activate && python -c "from src.utils.validation import validate_input_file; print('Validation import OK')"`
2. `python -c "from src.view import TransformView; print('View import OK')"`
3. Run the detailed test scripts from each task's verify section

All should pass without errors.
</verification>

<success_criteria>
- Validation module rejects invalid file paths with clear error messages
- Validation module accepts valid file paths and directories
- build_output_path preserves original filename (FILE-04)
- TransformView displays all required form fields
- Float validation prevents non-numeric input
- File dialogs filter for .ifc files
- View is ready for controller integration
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-transformation-basic-ui/01-02-SUMMARY.md`
</output>
